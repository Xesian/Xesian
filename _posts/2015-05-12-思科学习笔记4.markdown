---
layout:         post
title:          思科路由学习笔记4
description:    EIGRP 和 OSPF 配置
keywords: EIGRP,OSPF
---

#### **1、EIGRP的特点和操作**

> EIGRP是一个无类、增强的距离矢量协议，协议使用自治系统的概念来描述相邻路由器集合，处于自治系统中的路由器使用相同的路由选择协议并共享相同的路由选择信息。

  EIGRP支持VLSM,同时拥有距离矢量和链路状态两种协议特性，因此被称为混合型路由选择协议。由于EIGRP的链路状态特性，使得他非常适用于特大型的网络应用。EIGRP的最大跳计数为255，跳计数只用来限定EIGRP路由更新数据包在被抛弃之前可以经过的路由器个数，同时，这个数值用于限定AS的大小，而与如何计量度量无关。
  
EIGRP几个主要功能

>
+ 通过协议相关模块PDM(Protocol-Dependent Module)支持IP和IPV6(还有一些应用不广泛的被路由协议)； 
+ 被认为是无类的;
+ 支持VLSM/CIDR;
+ 支持汇总和不连续网络;
+ 高校的邻居发现;
+ 基于可靠传输协议(RTP)的通信;
+ 基于弥散更新算法(DUAL)的最佳路径选择。

###### **1.1 协议相关模块**

> 
 EIGRP通过PDM(Protocol-Dependent Module)为多种网络层协议提供路由支持.

###### **1.2 邻居发现**

> 链路状态协议都会选用Hello消息建立维护邻居关系。 

要建立邻居关系，必须满足三个条件：

> 
+ 接收到Hello包;
+ 实现AS号匹配;
+ 相同的度量值(K值)

相关术语：

> 
+ 可行距离(FD):等价于本路由到达远程网络的cost。可能有多个
+ 被报告/被通过距离(AD): 由邻居报告的到达远程网络的度量。
+ 邻居表：保存邻接邻居的状态信息。(保存在RAM中)。
+ 拓扑表：由协议相关模块根据弥散算法生成的，它包含所有由邻居通告的目标信息，以及每个被记录的目标地址和通告这些目标的邻居列表。(保存在RAM中)。
+ 可行的继任者：一条路径，它所通告的距离比可行距离差一点，因此被认为是一条**备份路由**。
+ 继任者：到达远端网络的最佳路由。

###### **1.3. 可靠传输协议**

> RTP:(Reliable Transport Protocol)管理路由间消息传递。思科利用杠杆原理调节组播和单播的工作机制，从而实现数据更新的快速投递以及接收数据的更新。

###### **1.4. 弥散更新算法**

这个算法可以实现:

> 
+ 随时的路由备份准备；
+ 支持VLSM;
+ 动态的路由恢复;
+ 如果没有发现可行的继任者路由则查询替换路由。

#### **2、使用EIGRP支持大型网络**

> EIGRP支持大型网络的特性：

+ 在单个路由上支持多个AS;
+ 支持VLSM和汇总;
+ 路由发现和维护;

#### **3、配置EIGRP**

两种配置模式

> 
+ 路由器配置模式:启用EIGRP协议，确定运行EIGRP网络，并完成全局参数的配置；
+ 接口模式：定制汇总和带宽。

 配置EIGRP网络：分两步走

> 
+ router eigrp as号(1~65536) (router eigrp 10)
+ network 与路由器相连的网络号 (network 192.168.1.0)

如果要在指定的接口停止EIGRP的运行，需要使用passive-interface *interface*，将接口标记为被动。

配置不连续网络:

> 
+ 当路由器连接两个不连续的网络时，为了让网络之间能互相访问，必须进行手工汇总，方法是在配置路由协议的模式下，启用 **no auto-summary**

#### **4、验证EIGRP**

|命令|功能|
|:----|:----|
|sh ip route|显示整个路由选择表|
|sh ip route eigrp|显示路由选择表中eigrp选项|
|sh ip eigrp neighbors|显示所有eigrp邻居|
|sh ip eigrp topology|显示eigrp 拓扑表中的表项|
|sh ip protocols|显示路由选择协议的配置|
|sh eigrp packet| 显示相邻路由器发送/接收的Hello数据包|
|sh ip eigrp events|显示网络上eigrp变化及更新时的eigrp事件|

#### **5、开放最短路径优先基础**

> ospf 是一个开放标准的路由选择协议，它基于Dijkstra算法来工作。首先，ospf要构造一个最短路径树，然后使用最佳路径的计算结果来组建路由选择表。

ospf主要功能:

> 
+ 由区域和自治系统组成的框架;
+ 最小化路由选择的更新流量;
+ 允许可缩放性能;
+ 支持VLSM/CIDR;
+ 拥有无线跳计数;
+ 允许多开发商的设备集成(开放的标准)。

ospf 以分层结构来设计，设计原因如下:

> 
+ 减少路由选择的开销;
+ 加速会聚;
+ 将网络的不稳定限制在单一的网络区域内。

ospf 必须有一个区域0。

###### **5.1 OSPF术语**

> 
+ 链路：一个网络或者一个被指定给任一给定网络的路由器接口。
+ 路由器ID:用来标识此路由的**IP地址**。
+ 邻居：可以是两个或者更多的路由器，这些路由器的某个接口是连接在同一个公共网络上。
+ 邻接: 指两个ospf路由之间的关系，这两个路由直接交换路由更新数据。
+ Hello协议：OSPF的Hello协议能动态发现邻居，并维护邻居关系。
+ 邻居关系数据库:一个ospf路由器的列表，这些路由器的Hello数据包相互可见。
+ 拓扑数据表:为同一区域所接收的所有链路状态通告数据包中的信息，路由器使用来自拓扑数据库中的信息，作为Dijkstra算法的输入。
+ 链路状态通告(LSA)：一个OSPF数据包，包含着OSPF路由器中共享的链路状态和路由选择信息。
+ 指定路由器(DR):无论什么时候，当ospf路由器连接到同一多路访问网络时，都需要选择哟个指定路由器。
+ 备份指定路由器(BDR)：在多路访问上随时待命的DR。
+ OSPF区域:一组相邻的网络和路由器。
+ 广播(多路访问)：网络允许多个设备连接(访问)到同一个网络上，并通过将单一数据包投递到网络中所有的节点来提供广播能力。
+ 非广播多路访问:诸如帧中继，X.25和异步传输(ATM)等网络，这些网络允许多路访问，但不具备广播能力。
+ 点到点：两个路由器直接连接组成的网络拓扑类型。
+ 点到多点：每个路由器上单一接口和多个目的路由器间的一系列连接。

###### **5.2 SPF树的计算**

> ospf 使用开销作为度量。开销与每个包好在spf树中的输出接口相关联。 使用 ip ospf cost 命令可以重写开销。

> 思科是基于带宽来建立链路开销的。

#### **6、配置ospf**

###### **6.1 启用ospf**

> router ospf 标志ospf的进程ID(1~65535) (router ospf 100) 

###### **6.2 配置ospf区域**

在标志了ospf进程以后，接下来需要标识想要进行的ospf通信的接口，路由器所在的区域。

ospf 在配置的中使用了通配符掩码(即子网掩码取反，如子网掩码为:255.255.255.0，则通配符掩码可为：0.0.0.255, 0.0.255.255)

配置如下:

> 
network network_id WildCardBit area (0-42亿)
  
例子:

>
+ router ospf 100
+ network 10.1.8.0 0.0.255.255 area 0

+ router ospf 101
+ network 192.168.1.16 0.0.0.15 area 10

#### **7、验证OSPF配置**

###### **show ip ospf**

> 显示云心在该路由上的一个或全部ospf进程的ospf信息。这些信息包括路由器ID,区域信息，SPF统计和LSA定时器信息。

###### **show ip ospf database**

> 给出在互联网络中路由器的编号，及相邻路由器的ID。

###### **show ip ospf interface**

> 给出所有与接口相关的ospf信息。

###### **show ip ospf neighbor**

> 汇总了ospf信息中关于邻居和邻接状态的信息。这一命令比较有用。

###### **调试ospf**

> 
+ debug ip ospf packet：显示在路由器上被接收的Hello数据包;
+ debug ip ospf hello: 显示在路由器上被发送和接收的数据包;
+ debug ip ospf adj:显示广播和非广播多路访问网络上的DR和BDR选举过程。

#### **8、OSPF的DR和BDR选举**

> 在进行选举之前，同一区域的路由器必须首先成为邻居，成为邻居的必要条件有:相同的区域ID，一致的Hello和dead间隔，必要时可以进行密码验证。


> DR 和BDR的选举都是通过Hello协议来完成的。在每个网络分段上Hello数据包是通过IP组播来交换的。然而，只有在广播和非广播多路访问网络的网络分段上才会进行DR和BDR的选举。点到点链路，例如WAN连接，不会进行DR.BDR选举。

#### **9、OSPF和环回接口**

> 环回接口是逻辑接口，即虚拟的软件接口，在ospf中使用环回接口是为了确保ospf进程中总存在一个激活的接口。

###### **配置环回接口**

> int loopback loopback_num 
> ip address xxx xxxx (一般使用私有ip地址,每个ip必须在一个独立的子网中，可以使用/32掩码)

例子:

> 
+ conf t
+ int loopback 0
+ ip address 172.32.1.3 255.255.255.255

###### **OSPF接口优先级**

> 可以使用优先级代替逻辑地址迫使某台路由器成为网络中的DR或BDR。

> 路由器的优先级的数值越高、成为DR的机会越大。0代表该路由器不参与选举。

 例子:

> 
+ conf t
+ int f0/0
+ ip ospf priority 2(0~255)




