---
layout:         post
title:          思科路由学习笔记7
description:    访问控制列表
keywords: ACL Access Control List
---



#### **1 外围路由器、防火墙和内部路由器**
  在大中型企业网络中，通常采用外围路由器，内部路由器和防火墙的配置来实现各种安全策略。内部路由器对前往企业网络中受保护部分的流量进行过滤，以进一步提高安全，这是通过访问控制列表实现的。
  
#### **2 访问控制列表简介**
 
 从本质上说，访问控制列表是一系列对分组进行分类的条件，它在需要控制网络数据流时很有用。
 
 将分组同访问控制列表进行比较时，一些原则如下：
 
 * 总是按**顺序**将分组与访问控制列表的每一行进行比较。
 * 不断比较，直到满足条件为止。
 * 每个访问控制列表末尾都有一条隐式的deny语句，这意味着如果不满足访问控制列表中任何行的条件，分组将被丢弃。
 
访问控制列表分为两大类：

* 标志访问控制列表：只将分组的**源IP地址**用作测试条件，所有决策都是根据源IP地址作出的。这意味着标志访问控制列表要么允许要么拒绝整个协议族，它不区分IP数据流类型。

* 扩展访问控制列表：能够检查IP分组的第3层和第4层报文头中众多字段。能够检查源IP地址，目标IP地址，网络层报文头的协议字段，传输层报文头中的端口号。


入站访问控制列表：将访问控制列表应用于入站分组，访问控制列表对分组进行处理，然后再将其路由到出站口，遇到拒绝的分组不会被路由。

出站访问控制列表：将访问控制可变应用于出站分组，分组将首先被路由到出站接口，然后根据访问控制列表对其进行处理。

在路由器上创建和实现访问控制列表时，应遵循一些通用的指导原则：

* 在接口的特定方向上，每种协议只能有一个访问控制列表。这意味着应用IP访问控制列表时，每个接口上只能有一个入站和一个出站访问控制列表。
* 在访问控制列表中，将具体的测试条件放在**前面**；
* 新增的语句将放在访问控制列表的末尾。(最好使用文本编辑器来编辑ACL)；
* 不能删除访问控制列表中的一行，如果这样做，将删除整个访问控制列表；
* 除非ACL以permit any 命令结尾，否则不满足任何条件的分组将被丢弃。访问控制列表至少应包含一条permit 语句，否则将拒绝所有所有的数据流；
* 创建ACL只有将它应有到接口上，才生效；
* ACL用于过滤穿越路由器的数据流，而不会始发于当前路由器的数据流进行过滤；
* 应将**标准访问控制列表**放在离**目的地**尽可能近的地方。
* 应将扩展访问控制列表放在离信源可能近的地方。

#### **3 标准访问控制列表**

标准访问控制列表根据**分组的源IP地址**来过滤网络数据流。创建标准IP访问控制列表时，使用访问控制列表编号1~99或者1300~1999（扩展范围）。

例子：access-list 10 deny host 192.168.1.2

###### **3.1 通配符掩码**

在访问控制列表中，可使用通配符来指定特定主机，特定网络或者网络的一部分。要理解通配符，必须理解块大小，它用于指定地址访问。

例子： 172.16.30.0 0.0.0.255 前3B必须完全相同，而第四个字节可以为任意值。

实际上，通配符掩码总是比块大小小1。

确定块大小和通配符掩码时，需记住如下两点：

* 起始位置必须为0或者块大小整数倍。如0~7,8~15,块大小为8时，起始位置不能为12.
* 命令any与0.0.0.0 255.255.255.255 等价。

示例：
    conf t
    access-list 10 deny 192.168.10.128 0.0.0.31
    access-list 10 permit any
    interface f0/0
    ip access-group 10 out
    
#### **4 扩展访问控制列表**

在访问控制列表中，可以指定源地址，目的地址，协议以及标识上层协议或者应用程序端口号。对于扩展访问控制列表，可以使用编号100~199，编号2000~2699也可用于该列表。


示例：

    access-list 110 deny tcp any host 172.16.50.5 eq 21
    access-list 110 deny tcp any host 172.16.50.5 eq 23（any 表示源地址，host 172 表示目的地址）
    access-list 110 permit ip any any

命名访问控制列表:让你能够使用命名来创建和应用标准和扩展访问控制列表。

示例:
   
    conf t
    ip access-list standard BlockSales
    deny 172.16.40.0 0.0.0.255
    permit any
    
    int f0/0
    ip access-group BlockSales out
    
注释remark:使得可以再ACL中添加注释

示例:

     access-list 110 remark Permit Bob from Sales Only to Finance
     access-lsit 110 permit ip host 172.16.40.1 172.16.50.0 0.0.0.255
     ...
     
#### **5 和配置网络服务**

 * 阻断snmp 分组: 
      
      access-list 110 deny udp any any eq snmp
      
      int s0/0/0
      
      access-group 110 in
      
 * 禁用echo 
 
   禁用chargen攻击:no service tcp/udp-small-servers
                  
   禁用finger:no service finger
   
 * 禁用BootP和自动配置
 
     no ip boot server
     
     no service config
     
     
* 禁用HTTP进程

  no ip http server
 
* 禁用IP源路由选择

  no ip source-route
  
* 禁用代理ARP

  int f0/0
  
  no ip proxy-arp
  
  
* 禁用重定向消息

  int f0/0
  
  no ip redirects
  
* 禁止生成ICMP不可达消息

  int f0/0
  
  no ip unreachable
  
* 禁用组播路由缓存

  int f0/0
  
  no ip mroute-cache
  
* 禁止维护操作协议

  int f0/0
  
  no mop enable
  
* 关闭X.25 PAD服务

  no service pad
  
* 启用 Nagle TCP 拥塞算法

  service nagle
  
* 禁用思科发现协议

  no cdp run
  
* 禁止转发UDP 协议分组

  no ip forward-protocol udp 49(端口号)
  
#### **6 件事访问控制列表**
 
* show access-list

  显示路由器中配置的所有访问控制列表及其参数，但不会指出其用于哪个接口
  
* show access-list 110 

  只显示ACL110的参数，但不会指出其用于哪个接口
  
* show ip access-list 

  只显示路由器上配置的IP访问控制列表
  
* show ip interface 

  显示应用了访问控制列表的接口
  
* show running-config

  显示访问控制列表及应用了访问控制列表的接口
 
